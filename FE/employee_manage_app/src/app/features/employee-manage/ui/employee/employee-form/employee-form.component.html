<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <nz-card [nzBordered]="false" class="shadow-sm rounded-3">
        <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
          <h4 class="mb-0 fw-bold text-primary">
            {{ isEditMode ? 'Edit Employee' : 'Add New Employee' }}
          </h4>
          <a nz-button nzType="link" (click)="onCancel()">
            <span nz-icon nzType="close"></span>
          </a>
        </div>

        <!-- Loading State -->
        @if (store.isMasterDataLoading()) {
        <div class="text-center py-5">
          <nz-spin nzTip="Loading master data..." nzSize="large"></nz-spin>
        </div>
        }

        <!-- Error State -->
        @if (store.error()) {
        <nz-alert nzType="error" nzMessage="Error" [nzDescription]="store.error()!" nzShowIcon nzCloseable
          (nzOnClose)="store.clearError()" class="mb-4">
        </nz-alert>
        }

        <!-- Form -->
        @if (!store.isMasterDataLoading()) {
        <form nz-form [formGroup]="form" (ngSubmit)="onSubmit()" nzLayout="vertical">
          <!-- Row 1: Name & Email -->
          <div class="row">
            <div class="col-md-6">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="name">Name</nz-form-label>
                <nz-form-control [nzErrorTip]="nameErrorTpl">
                  <input nz-input formControlName="name" id="name" placeholder="Enter full name" />
                  <ng-template #nameErrorTpl let-control>
                    @if (control.hasError('required')) { Name is required }
                    @if (control.hasError('minlength')) { Name must be > 3 chars }
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>

            <div class="col-md-6">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="email">Email</nz-form-label>
                <nz-form-control [nzErrorTip]="emailErrorTpl">
                  <input nz-input formControlName="email" id="email" placeholder="Enter email" />
                  <ng-template #emailErrorTpl let-control>
                    @if (control.hasError('required')) { Email is required }
                    @if (control.hasError('email')) { Invalid email format }
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Row 2: Phone -->
          <div class="row">
            <div class="col-md-6">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="contactNo">Phone</nz-form-label>
                <nz-form-control [nzErrorTip]="phoneErrorTpl">
                  <input nz-input formControlName="contactNo" id="contactNo" placeholder="10-digit number" />
                  <ng-template #phoneErrorTpl let-control>
                    @if (control.hasError('required')) { Phone is required }
                    @if (control.hasError('pattern')) { Must be 10 digits }
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Row 3: Designation -->
          <div class="row">
            <div class="col-md-6">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="designationId">Designation</nz-form-label>
                <nz-form-control [nzErrorTip]="'Please select a designation'">
                  <nz-select formControlName="designationId" nzPlaceHolder="Select Designation">
                    @for (des of store.designationOptions(); track des.id) {
                    <nz-option [nzValue]="des.id" [nzLabel]="des.name"></nz-option>
                    }
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Row 4: Address -->
          <nz-form-item>
            <nz-form-label nzRequired nzFor="address">Address</nz-form-label>
            <nz-form-control [nzErrorTip]="'Address is required'">
              <input nz-input formControlName="address" id="address" placeholder="Enter full address" />
            </nz-form-control>
          </nz-form-item>

          <!-- Row 5: City, State, Pincode -->
          <div class="row">
            <div class="col-md-4">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="city">City</nz-form-label>
                <nz-form-control [nzErrorTip]="'City is required'">
                  <input nz-input formControlName="city" id="city" placeholder="City" />
                </nz-form-control>
              </nz-form-item>
            </div>
            <div class="col-md-4">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="state">State</nz-form-label>
                <nz-form-control [nzErrorTip]="'State is required'">
                  <input nz-input formControlName="state" id="state" placeholder="State" />
                </nz-form-control>
              </nz-form-item>
            </div>
            <div class="col-md-4">
              <nz-form-item>
                <nz-form-label nzRequired nzFor="pincode">Pincode</nz-form-label>
                <nz-form-control [nzErrorTip]="pincodeErrorTpl">
                  <input nz-input formControlName="pincode" id="pincode" placeholder="6-digit pincode" />
                  <ng-template #pincodeErrorTpl let-control>
                    @if (control.hasError('required')) { Pincode required }
                    @if (control.hasError('pattern')) { Must be 6 digits }
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Row 6: Password -->
          <nz-form-item>
            <nz-form-label [nzRequired]="!isEditMode" nzFor="password">
              Password
              <small class="text-muted ms-2 font-weight-normal">
                {{ isEditMode ? '(Leave empty to keep current)' : '(Min 6 chars)' }}
              </small>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="passwordErrorTpl">
              <input nz-input type="password" formControlName="password" id="password" placeholder="Enter password" />
              <ng-template #passwordErrorTpl let-control>
                @if (control.hasError('required')) { Password is required }
                @if (control.hasError('minlength')) { Must be >= 6 chars }
              </ng-template>
            </nz-form-control>
          </nz-form-item>

          <!-- Form Actions -->
          <div class="d-flex justify-content-end gap-3 mt-4 pt-3 border-top">
            <button nz-button nzType="default" type="button" (click)="onCancel()" [disabled]="isSubmitting">
              Cancel
            </button>
            <button nz-button nzType="primary" type="submit" [nzLoading]="isSubmitting"
              [disabled]="!form.valid || isSubmitting || store.isMasterDataLoading()">
              {{ isEditMode ? 'Update' : 'Create' }}
            </button>
          </div>
        </form>
        }
      </nz-card>
    </div>
  </div>
</div>